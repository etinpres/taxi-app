<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ê³ ë„ë¹„ë§Œ íƒì‹œì¥ë¶€">
  <meta name="theme-color" content="#6366f1">
  <title>ê³ ë„ë¹„ë§Œ íƒì‹œì¥ë¶€</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸš•</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸš•</text></svg>">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body { margin: 0; padding: 0; overflow-x: hidden; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
    input, textarea, button { -webkit-user-select: text; user-select: text; }
    * { -webkit-overflow-scrolling: touch; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const Plus = ({ size = 24 }) => <i data-lucide="plus" style={{ width: size, height: size }}></i>;
    const TrendingUp = ({ size = 24 }) => <i data-lucide="trending-up" style={{ width: size, height: size }}></i>;
    const TrendingDown = ({ size = 24 }) => <i data-lucide="trending-down" style={{ width: size, height: size }}></i>;
    const Wallet = ({ size = 24, className = '' }) => <i data-lucide="wallet" className={className} style={{ width: size, height: size }}></i>;
    const Trash2 = ({ size = 24 }) => <i data-lucide="trash-2" style={{ width: size, height: size }}></i>;
    const Settings = ({ size = 24 }) => <i data-lucide="settings" style={{ width: size, height: size }}></i>;
    const Tag = ({ size = 24, className = '' }) => <i data-lucide="tag" className={className} style={{ width: size, height: size }}></i>;
    const Edit2 = ({ size = 24 }) => <i data-lucide="edit-2" style={{ width: size, height: size }}></i>;


function ExpenseTracker() {
  const [transactions, setTransactions] = useState(() => {
    try {
      const saved = localStorage.getItem('transactions');
      return saved ? JSON.parse(saved) : [];
    } catch (error) {
      console.error('Failed to load transactions:', error);
      return [];
    }
  });
  const [showForm, setShowForm] = useState(false);
  const [activeTab, setActiveTab] = useState('list'); // 'list' or 'calendar'
  const [currentMonth, setCurrentMonth] = useState(new Date());
  const [showCategoryManager, setShowCategoryManager] = useState(false);
  const [deleteConfirm, setDeleteConfirm] = useState(null); // { type, category }
  const [selectedDate, setSelectedDate] = useState(null); // for calendar day detail view
  const [headerExpanded, setHeaderExpanded] = useState(false); // header toggle
  const [editingTransaction, setEditingTransaction] = useState(null); // transaction being edited
  const [categories, setCategories] = useState(() => {
    try {
      const saved = localStorage.getItem('categories');
      return saved ? JSON.parse(saved) : {
        income: ['ì¹´ì¹´ì˜¤íƒì‹œ', 'ì¹´ë“œê²°ì œ', 'í˜„ê¸ˆê²°ì œ', 'íŒ'],
        expense: ['ì‹ë¹„', 'êµí†µ', 'ì‡¼í•‘', 'ì·¨ë¯¸', 'ê³µê³¼ê¸ˆ', 'ê¸°íƒ€']
      };
    } catch (error) {
      console.error('Failed to load categories:', error);
      return {
        income: ['ì¹´ì¹´ì˜¤íƒì‹œ', 'ì¹´ë“œê²°ì œ', 'í˜„ê¸ˆê²°ì œ', 'íŒ'],
        expense: ['ì‹ë¹„', 'êµí†µ', 'ì‡¼í•‘', 'ì·¨ë¯¸', 'ê³µê³¼ê¸ˆ', 'ê¸°íƒ€']
      };
    }
  });
  const [newCategory, setNewCategory] = useState('');
  const [categoryType, setCategoryType] = useState('expense');
  const [formData, setFormData] = useState({
    type: 'expense',
    amount: '',
    category: '',
    description: '',
    date: new Date().toISOString().split('T')[0]
  });

  // localStorageì— transactions ì €ì¥
  useEffect(() => {
    try {
      localStorage.setItem('transactions', JSON.stringify(transactions));
    } catch (error) {
      console.error('Failed to save transactions:', error);
    }
  }, [transactions]);

  // localStorageì— categories ì €ì¥
  useEffect(() => {
    try {
      localStorage.setItem('categories', JSON.stringify(categories));
    } catch (error) {
      console.error('Failed to save categories:', error);
    }
  }, [categories]);

  // ì´ ìˆ˜ì…, ì§€ì¶œ, ì”ì•¡ ê³„ì‚°
  const summary = transactions.reduce((acc, transaction) => {
    if (transaction.type === 'income') {
      acc.income += transaction.amount;
    } else {
      acc.expense += transaction.amount;
    }
    return acc;
  }, { income: 0, expense: 0 });

  const balance = summary.income - summary.expense;

  const handleSubmit = (e) => {
    e.preventDefault();
    
    if (!formData.amount || !formData.category) {
      alert('ê¸ˆì•¡ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    if (editingTransaction) {
      // ìˆ˜ì • ëª¨ë“œ
      const updatedTransaction = {
        ...editingTransaction,
        ...formData,
        amount: parseFloat(formData.amount.replace(/,/g, ''))
      };
      setTransactions(transactions.map(t => 
        t.id === editingTransaction.id ? updatedTransaction : t
      ));
      setEditingTransaction(null);
    } else {
      // ìƒˆë¡œ ì¶”ê°€ ëª¨ë“œ
      const newTransaction = {
        id: Date.now(),
        ...formData,
        amount: parseFloat(formData.amount.replace(/,/g, ''))
      };
      setTransactions([newTransaction, ...transactions]);
    }

    setFormData({
      type: 'expense',
      amount: '',
      category: '',
      description: '',
      date: new Date().toISOString().split('T')[0]
    });
    setShowForm(false);
  };

  const startEditTransaction = (transaction) => {
    setEditingTransaction(transaction);
    setFormData({
      type: transaction.type,
      amount: formatCurrency(transaction.amount),
      category: transaction.category,
      description: transaction.description || '',
      date: transaction.date
    });
    setShowForm(true);
  };

  const cancelEdit = () => {
    setEditingTransaction(null);
    setFormData({
      type: 'expense',
      amount: '',
      category: '',
      description: '',
      date: new Date().toISOString().split('T')[0]
    });
    setShowForm(false);
  };

  const handleAmountChange = (e) => {
    const value = e.target.value.replace(/,/g, '');
    if (value === '' || /^\d+$/.test(value)) {
      const formatted = value === '' ? '' : parseInt(value).toLocaleString('ko-KR');
      setFormData({ ...formData, amount: formatted });
    }
  };

  const deleteTransaction = (id) => {
    setTransactions(transactions.filter(t => t.id !== id));
  };

  const clearAllData = () => {
    if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      setTransactions([]);
      localStorage.removeItem('transactions');
    }
  };

  const addCategory = () => {
    if (!newCategory.trim()) {
      alert('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }
    
    if (categories[categoryType].includes(newCategory.trim())) {
      alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤');
      return;
    }

    setCategories(prev => ({
      ...prev,
      [categoryType]: [...prev[categoryType], newCategory.trim()]
    }));
    setNewCategory('');
  };

  const deleteCategory = (type, categoryName) => {
    setDeleteConfirm({ type, category: categoryName });
  };

  const confirmDelete = () => {
    if (deleteConfirm) {
      const { type, category } = deleteConfirm;
      setCategories(prev => ({
        ...prev,
        [type]: prev[type].filter(cat => cat !== category)
      }));
      setDeleteConfirm(null);
    }
  };

  const cancelDelete = () => {
    setDeleteConfirm(null);
  };

  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('ko-KR').format(amount);
  };

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return `${date.getMonth() + 1}/${date.getDate()}`;
  };

  // ìº˜ë¦°ë” ê´€ë ¨ í•¨ìˆ˜ë“¤
  const getDaysInMonth = (date) => {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay();
    
    return { daysInMonth, startingDayOfWeek, year, month };
  };

  const getTransactionsForDate = (date) => {
    // ë¡œì»¬ ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì‹œê°„ëŒ€ ë¬¸ì œ ë°©ì§€)
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const dateString = `${year}-${month}-${day}`;
    return transactions.filter(t => t.date === dateString);
  };

  const getMonthSummary = () => {
    const year = currentMonth.getFullYear();
    const month = currentMonth.getMonth();
    
    return transactions
      .filter(t => {
        // YYYY-MM-DD í˜•ì‹ì˜ ë¬¸ìì—´ì„ íŒŒì‹± (ì‹œê°„ëŒ€ ë¬¸ì œ ë°©ì§€)
        const [tYear, tMonth] = t.date.split('-').map(Number);
        return tYear === year && tMonth - 1 === month;
      })
      .reduce((acc, transaction) => {
        if (transaction.type === 'income') {
          acc.income += transaction.amount;
        } else {
          acc.expense += transaction.amount;
        }
        return acc;
      }, { income: 0, expense: 0 });
  };

  const changeMonth = (direction) => {
    setCurrentMonth(prev => {
      const newDate = new Date(prev);
      newDate.setMonth(prev.getMonth() + direction);
      return newDate;
    });
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 pb-20">
      {/* í—¤ë” */}
      <div className="relative overflow-hidden">
        {/* Glassmorphism background */}
        <div className="absolute inset-0 bg-gradient-to-br from-blue-500/90 via-indigo-500/90 to-purple-600/90 backdrop-blur-xl"></div>
        <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent"></div>
        
        <div className="relative text-white p-4">
          <div className="flex items-center justify-between mb-3">
            <h1 className="text-lg font-semibold tracking-tight">ğŸš• ê³ ë„ë¹„ë§Œ íƒì‹œì¥ë¶€</h1>
            <button
              onClick={() => setShowCategoryManager(true)}
              className="p-2 bg-white/15 backdrop-blur-2xl rounded-xl border border-white/20 hover:bg-white/25 transition-all"
              title="ì¹´í…Œê³ ë¦¬ ê´€ë¦¬"
            >
              <Settings size={18} />
            </button>
          </div>
          
          {/* ì¶•ì†Œëœ í—¤ë” */}
          <button
            onClick={() => setHeaderExpanded(!headerExpanded)}
            className="w-full bg-white/15 backdrop-blur-2xl rounded-2xl p-3 border border-white/20 shadow-xl transition-all hover:bg-white/20"
          >
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Wallet size={16} className="opacity-80" />
                <span className="text-sm font-medium">ì†ìµ</span>
              </div>
              <div className="text-xl font-semibold">
                {formatCurrency(balance)}ì›
              </div>
              <div className="text-white/60">
                {headerExpanded ? 'â–¼' : 'â–¶'}
              </div>
            </div>
          </button>

          {/* í¼ì³ì§„ ìƒì„¸ ì •ë³´ */}
          {headerExpanded && (
            <div className="mt-3 space-y-2 animate-in fade-in slide-in-from-top-2 duration-200">
              <div className="grid grid-cols-2 gap-2">
                <div className="bg-white/10 backdrop-blur-2xl rounded-xl p-3 border border-white/20">
                  <div className="flex items-center gap-1.5 mb-1">
                    <TrendingUp size={14} className="opacity-80" />
                    <span className="text-xs font-medium opacity-80">ìˆ˜ì…</span>
                  </div>
                  <div className="text-lg font-semibold">
                    +{formatCurrency(summary.income)}
                  </div>
                </div>
                <div className="bg-white/10 backdrop-blur-2xl rounded-xl p-3 border border-white/20">
                  <div className="flex items-center gap-1.5 mb-1">
                    <TrendingDown size={14} className="opacity-80" />
                    <span className="text-xs font-medium opacity-80">ì§€ì¶œ</span>
                  </div>
                  <div className="text-lg font-semibold">
                    -{formatCurrency(summary.expense)}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="px-4 pt-4 pb-2">
        <div className="bg-white/60 backdrop-blur-xl rounded-2xl p-1.5 grid grid-cols-2 gap-1.5 border border-white/40 shadow-lg">
          <button
            onClick={() => setActiveTab('list')}
            className={`py-3 px-4 rounded-xl font-medium transition-all duration-200 ${
              activeTab === 'list'
                ? 'bg-white text-indigo-600 shadow-md'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            ëª©ë¡
          </button>
          <button
            onClick={() => setActiveTab('calendar')}
            className={`py-3 px-4 rounded-xl font-medium transition-all duration-200 ${
              activeTab === 'calendar'
                ? 'bg-white text-indigo-600 shadow-md'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            ìº˜ë¦°ë”
          </button>
        </div>
      </div>

      {/* ëª©ë¡ ë·° */}
      {activeTab === 'list' && (
        <div className="p-4">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-lg font-semibold text-gray-800">ìµœê·¼ ë‚´ì—­</h2>
            {transactions.length > 0 && (
              <button
                onClick={clearAllData}
                className="text-sm text-red-500 hover:text-red-600 font-medium transition-colors"
              >
                ì „ì²´ ì‚­ì œ
              </button>
            )}
          </div>
          
          {transactions.length === 0 ? (
            <div className="text-center py-16 text-gray-400">
              <Wallet size={48} className="mx-auto mb-3 opacity-30" />
              <p className="font-medium">ì•„ì§ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
              <p className="text-sm mt-1">+ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
            </div>
          ) : (
            <div className="space-y-2">
              {[...transactions]
                .sort((a, b) => {
                  // ë‚ ì§œë¥¼ ë¹„êµ (ìµœì‹  ë‚ ì§œê°€ ìœ„ë¡œ)
                  if (a.date !== b.date) {
                    return b.date.localeCompare(a.date);
                  }
                  // ê°™ì€ ë‚ ì§œë©´ IDë¡œ ì •ë ¬ (ìµœê·¼ ì…ë ¥ì´ ìœ„ë¡œ)
                  return b.id - a.id;
                })
                .map(transaction => (
                <div 
                  key={transaction.id}
                  className="bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-white/60 shadow-lg flex items-center justify-between hover:bg-white/90 transition-all"
                >
                  <div className="flex items-center gap-3 flex-1">
                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm ${
                      transaction.type === 'income' 
                        ? 'bg-gradient-to-br from-green-400 to-emerald-500 text-white' 
                        : 'bg-gradient-to-br from-red-400 to-rose-500 text-white'
                    }`}>
                      {transaction.type === 'income' ? (
                        <TrendingUp size={20} />
                      ) : (
                        <TrendingDown size={20} />
                      )}
                    </div>
                    
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-semibold text-gray-800">
                          {transaction.category}
                        </span>
                        <span className="text-xs text-gray-400 font-medium">
                          {formatDate(transaction.date)}
                        </span>
                      </div>
                      {transaction.description && (
                        <p className="text-sm text-gray-500 truncate">
                          {transaction.description}
                        </p>
                      )}
                    </div>
                  </div>

                  <div className="flex items-center gap-2">
                    <div className={`text-lg font-semibold ${
                      transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                    }`}>
                      {transaction.type === 'income' ? '+' : '-'}
                      {formatCurrency(transaction.amount)}
                    </div>
                    <button
                      onClick={() => startEditTransaction(transaction)}
                      className="text-gray-400 hover:text-indigo-500 transition-colors p-1"
                    >
                      <Edit2 size={18} />
                    </button>
                    <button
                      onClick={() => deleteTransaction(transaction.id)}
                      className="text-gray-400 hover:text-red-500 transition-colors p-1"
                    >
                      <Trash2 size={18} />
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      {/* ìº˜ë¦°ë” ë·° */}
      {activeTab === 'calendar' && (
        <div className="p-4">
          {/* ì›” ì„ íƒ */}
          <div className="flex items-center justify-between mb-4">
            <button
              onClick={() => changeMonth(-1)}
              className="p-2.5 hover:bg-white/60 rounded-xl transition-all backdrop-blur-xl"
            >
              <span className="text-lg font-semibold text-gray-700">â†</span>
            </button>
            <h2 className="text-lg font-semibold text-gray-800">
              {currentMonth.getFullYear()}ë…„ {currentMonth.getMonth() + 1}ì›”
            </h2>
            <button
              onClick={() => changeMonth(1)}
              className="p-2.5 hover:bg-white/60 rounded-xl transition-all backdrop-blur-xl"
            >
              <span className="text-lg font-semibold text-gray-700">â†’</span>
            </button>
          </div>

          {/* ì›”ê°„ ìš”ì•½ */}
          <div className="bg-white/80 backdrop-blur-xl rounded-2xl p-5 mb-4 border border-white/60 shadow-lg">
            <div className="grid grid-cols-2 gap-6">
              <div>
                <div className="text-sm text-gray-500 mb-2 font-medium">ì´ë‹¬ ìˆ˜ì…</div>
                <div className="text-xl font-semibold text-green-600">
                  +{formatCurrency(getMonthSummary().income)}
                </div>
              </div>
              <div>
                <div className="text-sm text-gray-500 mb-2 font-medium">ì´ë‹¬ ì§€ì¶œ</div>
                <div className="text-xl font-semibold text-red-600">
                  -{formatCurrency(getMonthSummary().expense)}
                </div>
              </div>
            </div>
          </div>

          {/* ìš”ì¼ í—¤ë” */}
          <div className="grid grid-cols-7 gap-1 mb-2">
            {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map((day, idx) => (
              <div key={day} className={`text-center text-sm font-semibold py-2 ${
                idx === 0 ? 'text-red-500' : idx === 6 ? 'text-blue-500' : 'text-gray-600'
              }`}>
                {day}
              </div>
            ))}
          </div>

          {/* ìº˜ë¦°ë” ê·¸ë¦¬ë“œ */}
          <div className="grid grid-cols-7 gap-1.5">
            {(() => {
              const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(currentMonth);
              const days = [];
              
              // ì´ì „ ë‹¬ì˜ ë¹ˆ ì¹¸
              for (let i = 0; i < startingDayOfWeek; i++) {
                days.push(
                  <div key={`empty-${i}`} className="aspect-square p-0.5">
                    <div className="h-full bg-gray-100/50 rounded-xl"></div>
                  </div>
                );
              }
              
              // í˜„ì¬ ë‹¬ì˜ ë‚ ì§œë“¤
              for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayTransactions = getTransactionsForDate(date);
                const dayIncome = dayTransactions
                  .filter(t => t.type === 'income')
                  .reduce((sum, t) => sum + t.amount, 0);
                const dayExpense = dayTransactions
                  .filter(t => t.type === 'expense')
                  .reduce((sum, t) => sum + t.amount, 0);
                
                const isToday = 
                  new Date().getDate() === day &&
                  new Date().getMonth() === month &&
                  new Date().getFullYear() === year;
                
                const isSunday = date.getDay() === 0;
                const isSaturday = date.getDay() === 6;
                
                days.push(
                  <div key={day} className="aspect-square p-0.5">
                    <button
                      onClick={() => setSelectedDate(date)}
                      className={`w-full h-full bg-white/70 backdrop-blur-xl rounded-xl p-1.5 flex flex-col items-center justify-between border transition-all ${
                        isToday 
                          ? 'ring-2 ring-indigo-500 border-indigo-200 bg-white/90' 
                          : 'border-white/60 hover:bg-white/90'
                      }`}
                    >
                      <div className={`text-xs font-semibold ${
                        isToday 
                          ? 'text-indigo-600' 
                          : isSunday 
                            ? 'text-red-500'
                            : isSaturday
                              ? 'text-blue-500'
                              : 'text-gray-700'
                      }`}>
                        {day}
                      </div>
                      {dayTransactions.length > 0 && (
                        <div className="flex gap-1 mt-auto">
                          {dayIncome > 0 && (
                            <div className="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                          )}
                          {dayExpense > 0 && (
                            <div className="w-1.5 h-1.5 rounded-full bg-red-500"></div>
                          )}
                        </div>
                      )}
                    </button>
                  </div>
                );
              }
              
              return days;
            })()}
          </div>
        </div>
      )}

      {/* ì¶”ê°€ ë²„íŠ¼ */}
      <button
        onClick={() => setShowForm(true)}
        className="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-2xl shadow-2xl flex items-center justify-center hover:shadow-indigo-500/50 hover:scale-105 transition-all duration-200 border border-white/20"
      >
        <Plus size={28} strokeWidth={2.5} />
      </button>

      {/* ì…ë ¥ í¼ ëª¨ë‹¬ */}
      {showForm && (
        <div className="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-end z-50 animate-in fade-in duration-200">
          <div className="bg-white/95 backdrop-blur-2xl w-full rounded-t-3xl p-6 max-h-[85vh] overflow-y-auto border-t border-white/60 shadow-2xl">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-gray-800">
                {editingTransaction ? 'ë‚´ì—­ ìˆ˜ì •' : 'ë‚´ì—­ ì¶”ê°€'}
              </h2>
              <button
                onClick={cancelEdit}
                className="text-gray-400 hover:text-gray-600 transition-colors w-8 h-8 flex items-center justify-center rounded-xl hover:bg-gray-100"
              >
                <span className="text-2xl leading-none">Ã—</span>
              </button>
            </div>

            <form onSubmit={handleSubmit} className="space-y-5">
              {/* íƒ€ì… ì„ íƒ */}
              <div className="grid grid-cols-2 gap-3">
                <button
                  type="button"
                  onClick={() => setFormData({ ...formData, type: 'income', category: '' })}
                  className={`py-3.5 rounded-2xl font-semibold transition-all duration-200 ${
                    formData.type === 'income'
                      ? 'bg-gradient-to-br from-green-500 to-emerald-600 text-white shadow-lg shadow-green-500/30'
                      : 'bg-gray-100/80 text-gray-600 hover:bg-gray-200/80'
                  }`}
                >
                  ìˆ˜ì…
                </button>
                <button
                  type="button"
                  onClick={() => setFormData({ ...formData, type: 'expense', category: '' })}
                  className={`py-3.5 rounded-2xl font-semibold transition-all duration-200 ${
                    formData.type === 'expense'
                      ? 'bg-gradient-to-br from-red-500 to-rose-600 text-white shadow-lg shadow-red-500/30'
                      : 'bg-gray-100/80 text-gray-600 hover:bg-gray-200/80'
                  }`}
                >
                  ì§€ì¶œ
                </button>
              </div>

              {/* ê¸ˆì•¡ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2.5">
                  ê¸ˆì•¡
                </label>
                <input
                  type="text"
                  inputMode="numeric"
                  pattern="[0-9,]*"
                  value={formData.amount}
                  onChange={handleAmountChange}
                  placeholder="ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”"
                  className="w-full px-4 py-3.5 bg-white/80 border-2 border-gray-200/80 rounded-2xl focus:border-indigo-400 focus:outline-none focus:bg-white transition-all"
                  required
                />
              </div>

              {/* ì¹´í…Œê³ ë¦¬ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2.5">
                  ì¹´í…Œê³ ë¦¬
                </label>
                <div className="grid grid-cols-3 gap-2">
                  {categories[formData.type].map(cat => (
                    <button
                      key={cat}
                      type="button"
                      onClick={() => setFormData({ ...formData, category: cat })}
                      className={`py-2.5 px-3 rounded-xl text-sm font-medium transition-all duration-200 ${
                        formData.category === cat
                          ? 'bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30'
                          : 'bg-gray-100/80 text-gray-600 hover:bg-gray-200/80'
                      }`}
                    >
                      {cat}
                    </button>
                  ))}
                </div>
              </div>

              {/* ë‚ ì§œ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2.5">
                  ë‚ ì§œ
                </label>
                <input
                  type="date"
                  value={formData.date}
                  onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                  className="w-full px-4 py-3.5 bg-white/80 border-2 border-gray-200/80 rounded-2xl focus:border-indigo-400 focus:outline-none focus:bg-white transition-all appearance-none"
                  style={{ WebkitAppearance: 'none', MozAppearance: 'none' }}
                  required
                />
              </div>

              {/* ë©”ëª¨ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2.5">
                  ë©”ëª¨ (ì„ íƒ)
                </label>
                <input
                  type="text"
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  placeholder="ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                  className="w-full px-4 py-3.5 bg-white/80 border-2 border-gray-200/80 rounded-2xl focus:border-indigo-400 focus:outline-none focus:bg-white transition-all"
                />
              </div>

              {/* ì œì¶œ ë²„íŠ¼ */}
              <button
                type="submit"
                className="w-full py-4 bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-semibold rounded-2xl shadow-lg shadow-indigo-500/40 hover:shadow-xl hover:scale-[1.02] transition-all duration-200"
              >
                {editingTransaction ? 'ìˆ˜ì •í•˜ê¸°' : 'ì¶”ê°€í•˜ê¸°'}
              </button>
            </form>
          </div>
        </div>
      )}

      {/* ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ëª¨ë‹¬ */}
      {showCategoryManager && (
        <div className="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-end z-50 animate-in fade-in duration-200">
          <div className="bg-white/95 backdrop-blur-2xl w-full rounded-t-3xl p-6 max-h-[85vh] overflow-y-auto border-t border-white/60 shadow-2xl">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-gray-800">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
              <button
                onClick={() => setShowCategoryManager(false)}
                className="text-gray-400 hover:text-gray-600 transition-colors w-8 h-8 flex items-center justify-center rounded-xl hover:bg-gray-100"
              >
                <span className="text-2xl leading-none">Ã—</span>
              </button>
            </div>

            {/* íƒ€ì… ì„ íƒ */}
            <div className="grid grid-cols-2 gap-3 mb-6">
              <button
                type="button"
                onClick={() => setCategoryType('income')}
                className={`py-3.5 rounded-2xl font-semibold transition-all duration-200 ${
                  categoryType === 'income'
                    ? 'bg-gradient-to-br from-green-500 to-emerald-600 text-white shadow-lg shadow-green-500/30'
                    : 'bg-gray-100/80 text-gray-600 hover:bg-gray-200/80'
                }`}
              >
                ìˆ˜ì… ì¹´í…Œê³ ë¦¬
              </button>
              <button
                type="button"
                onClick={() => setCategoryType('expense')}
                className={`py-3.5 rounded-2xl font-semibold transition-all duration-200 ${
                  categoryType === 'expense'
                    ? 'bg-gradient-to-br from-red-500 to-rose-600 text-white shadow-lg shadow-red-500/30'
                    : 'bg-gray-100/80 text-gray-600 hover:bg-gray-200/80'
                }`}
              >
                ì§€ì¶œ ì¹´í…Œê³ ë¦¬
              </button>
            </div>

            {/* ì¹´í…Œê³ ë¦¬ ì¶”ê°€ */}
            <div className="mb-6">
              <label className="block text-sm font-semibold text-gray-700 mb-2.5">
                ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
              </label>
              <div className="flex gap-2">
                <input
                  type="text"
                  value={newCategory}
                  onChange={(e) => setNewCategory(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && addCategory()}
                  placeholder="ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì…ë ¥"
                  className="flex-1 px-4 py-3 bg-white/80 border-2 border-gray-200/80 rounded-2xl focus:border-indigo-400 focus:outline-none focus:bg-white transition-all"
                />
                <button
                  onClick={addCategory}
                  className="px-6 py-3 bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-semibold rounded-2xl shadow-lg shadow-indigo-500/40 hover:shadow-xl hover:scale-[1.02] transition-all duration-200"
                >
                  ì¶”ê°€
                </button>
              </div>
            </div>

            {/* ì¹´í…Œê³ ë¦¬ ëª©ë¡ */}
            <div>
              <h3 className="text-sm font-semibold text-gray-700 mb-3">
                {categoryType === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'} ì¹´í…Œê³ ë¦¬
              </h3>
              <div className="space-y-2">
                {categories[categoryType].map((cat, index) => (
                  <div
                    key={index}
                    className="bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-white/60 shadow-lg flex items-center justify-between hover:bg-white/90 transition-all"
                  >
                    <span className="font-medium text-gray-800">{cat}</span>
                    <button
                      type="button"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        deleteCategory(categoryType, cat);
                      }}
                      className="text-gray-400 hover:text-red-500 transition-colors p-1"
                    >
                      <Trash2 size={18} />
                    </button>
                  </div>
                ))}
                {categories[categoryType].length === 0 && (
                  <div className="text-center py-8 text-gray-400">
                    <Tag size={40} className="mx-auto mb-2 opacity-30" />
                    <p className="text-sm">ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      {deleteConfirm && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4">
          <div className="bg-white/95 backdrop-blur-2xl rounded-3xl p-6 max-w-sm w-full border border-white/60 shadow-2xl">
            <h3 className="text-lg font-semibold text-gray-800 mb-3">ì¹´í…Œê³ ë¦¬ ì‚­ì œ</h3>
            <p className="text-gray-600 mb-6">
              '<span className="font-semibold text-gray-800">{deleteConfirm.category}</span>' ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </p>
            <div className="grid grid-cols-2 gap-3">
              <button
                onClick={cancelDelete}
                className="py-3 px-4 bg-gray-100/80 text-gray-700 font-semibold rounded-2xl hover:bg-gray-200/80 transition-all"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmDelete}
                className="py-3 px-4 bg-gradient-to-br from-red-500 to-rose-600 text-white font-semibold rounded-2xl shadow-lg shadow-red-500/30 hover:shadow-xl hover:scale-[1.02] transition-all duration-200"
              >
                ì‚­ì œ
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ë‚ ì§œ ìƒì„¸ ëª¨ë‹¬ */}
      {selectedDate && (
        <div 
          className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end z-[90] p-4"
          onClick={() => setSelectedDate(null)}
        >
          <div 
            className="bg-white/95 backdrop-blur-2xl rounded-3xl p-6 max-w-sm w-full mx-auto border border-white/60 shadow-2xl max-h-[70vh] overflow-y-auto"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg font-semibold text-gray-800">
                {selectedDate.getMonth() + 1}ì›” {selectedDate.getDate()}ì¼
              </h3>
              <button
                onClick={() => setSelectedDate(null)}
                className="text-gray-400 hover:text-gray-600 transition-colors w-8 h-8 flex items-center justify-center rounded-xl hover:bg-gray-100"
              >
                <span className="text-2xl leading-none">Ã—</span>
              </button>
            </div>
            
            {(() => {
              const dayTransactions = getTransactionsForDate(selectedDate);
              const dayIncome = dayTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
              const dayExpense = dayTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
              
              return (
                <>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <div className="bg-green-50 rounded-xl p-3">
                      <div className="text-xs text-green-600 mb-1">ìˆ˜ì…</div>
                      <div className="text-lg font-semibold text-green-600">
                        +{formatCurrency(dayIncome)}
                      </div>
                    </div>
                    <div className="bg-red-50 rounded-xl p-3">
                      <div className="text-xs text-red-600 mb-1">ì§€ì¶œ</div>
                      <div className="text-lg font-semibold text-red-600">
                        -{formatCurrency(dayExpense)}
                      </div>
                    </div>
                  </div>
                  
                  {dayTransactions.length > 0 ? (
                    <div className="space-y-2">
                      {[...dayTransactions]
                        .sort((a, b) => b.id - a.id)
                        .map(transaction => (
                        <div 
                          key={transaction.id}
                          className="bg-gray-50 rounded-xl p-3 flex items-center justify-between"
                        >
                          <div className="flex items-center gap-3 flex-1">
                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${
                              transaction.type === 'income' 
                                ? 'bg-green-100 text-green-600' 
                                : 'bg-red-100 text-red-600'
                            }`}>
                              {transaction.type === 'income' ? (
                                <TrendingUp size={16} />
                              ) : (
                                <TrendingDown size={16} />
                              )}
                            </div>
                            <div className="flex-1 min-w-0">
                              <div className="font-medium text-gray-800 text-sm">
                                {transaction.category}
                              </div>
                              {transaction.description && (
                                <p className="text-xs text-gray-500 truncate">
                                  {transaction.description}
                                </p>
                              )}
                            </div>
                          </div>
                          <div className={`font-semibold text-sm ${
                            transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                          }`}>
                            {transaction.type === 'income' ? '+' : '-'}
                            {formatCurrency(transaction.amount)}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="text-center py-8 text-gray-400">
                      <p className="text-sm">ì´ ë‚ ì§œì— ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                  )}
                </>
              );
            })()}
          </div>
        </div>
      )}
    </div>
  );
}

    useEffect(() => { lucide.createIcons(); });
    ReactDOM.render(<ExpenseTracker />, document.getElementById('root'));
  </script>
  
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').then(reg => console.log('SW registered')).catch(err => console.log('SW failed'));
      });
    }
  </script>
</body>
</html>
